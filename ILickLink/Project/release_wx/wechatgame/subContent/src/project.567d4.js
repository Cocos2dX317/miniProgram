window.__require=function e(t,n,o){function a(i,c){if(!n[i]){if(!t[i]){var l=i.split("/");if(l=l[l.length-1],!t[l]){var s="function"==typeof __require&&__require;if(!c&&s)return s(l,!0);if(r)return r(l,!0);throw new Error("Cannot find module '"+i+"'")}}var u=n[i]={exports:{}};t[i][0].call(u.exports,function(e){return a(t[i][1][e]||e)},u,u.exports,e,t,n,o)}return n[i].exports}for(var r="function"==typeof __require&&__require,i=0;i<o.length;i++)a(o[i]);return a}({SubScene:[function(e,t,n){"use strict";cc._RF.push(t,"e44a5QBzFBBIYgEAiCPD134","SubScene"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(e){this.fun_name="",this.res="",this.fun_name=e}}();n.WX_OpenData=o;var a,r=cc._decorator,i=r.ccclass,c=r.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rankScroll=null,t.rankItem=null,t.selfItem=null,t.userInfo={nickName:"",openID:""},t}return __extends(t,e),t.prototype.start=function(){window.wx?this.onMessage():this.updateRankScroll([])},t.prototype.updateRankScroll=function(e){console.info("\u66f4\u65b0\u5fae\u4fe1\u6392\u884c\u699c SubScene.updateRankScroll:",e);var t=this.rankScroll.getComponent(cc.ScrollView);if(t.content.removeAllChildren(),!(e.length<=0)){var n=this.rankItem.height+10;t.content.height=e.length*n;for(var o=!1,r=0;r<e.length;r++){var i=e[r],c=cc.instantiate(this.rankItem);c.active=!0,t.content.addChild(c),c.setPosition(cc.v2(0,-r*n-n/2));var l=c.getChildByName("iconMask").getChildByName("head");this.loadHttpIcon(l,i.avatarUrl,function(){}),c.getChildByName("name").getComponent(cc.Label).string=i.nickname;var s=JSON.parse(i.KVDataList[0].value);c.getChildByName("score").getComponent(cc.Label).string=s.score,c.getChildByName("layer").getComponent(cc.Label).string=s.layer+"\u5c42",c.getChildByName("rank").getComponent(cc.Label).string="NO."+(r+1),i.openid==this.userInfo.openID?(a=r+1,o=!0):i.nickname==this.userInfo.nickName&&(a=r+1,o=!0)}o&&(this.selfItem.active=!0,this.setmyrank())}},t.prototype.setmyrank=function(){var e=this;window.wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(t){e.selfItem.getChildByName("myname").getComponent(cc.Label).string=t.data[0].nickName;var n=e.selfItem.getChildByName("myhead");e.loadHttpIcon(n,t.data[0].avatarUrl,function(){})},fail:function(e){}}),window.wx.getUserCloudStorage({keyList:["rxgx"],success:function(t){var n=t.KVDataList;if(console.info("\u83b7\u5f97\u7528\u6237\u6570\u636e\uff1a",t),!(t.KVDataList.length<=0)){var o=JSON.parse(n[0].value);e.selfItem.getChildByName("myscore").getComponent(cc.Label).string=o.score,e.selfItem.getChildByName("mylayer").getComponent(cc.Label).string=o.layer+"\u5c42",e.selfItem.getChildByName("myrank").getComponent(cc.Label).string="NO."+a}},fail:function(e){console.info("\u83b7\u53d6\u4fe1\u606f\u5931\u8d25")},complete:function(e){}})},t.prototype.getRankInfo=function(e){for(var t=new Array,n=0;n<e.length;n++)e[n].KVDataList.length>0&&"rxgx"==e[n].KVDataList[0].key&&t.push(e[n]);return t.sort(function(e,t){var n=JSON.parse(e.KVDataList[0].value),o=JSON.parse(t.KVDataList[0].value);return n.layer>o.layer?-1:n.layer==o.layer&&n.score>o.score?-1:1}),t},t.prototype.onMessage=function(){var e=this,t=this;window.wx.onMessage(function(n){if(console.log(n),"setUserCloudStorage"==n.fun_name)window.wx.setUserCloudStorage({KVDataList:[{key:"rxgx",value:JSON.stringify(n.data)}],success:function(e){console.log(e)},fail:function(e){console.log(e)}});else if("getFriendCloudStorage"==n.fun_name)window.wx.getFriendCloudStorage({keyList:["rxgx"],success:function(e){n.data&&(t.userInfo.openID=n.data.openID,t.userInfo.nickName=n.data.nickName),t.updateRankScroll(t.getRankInfo(e.data))},fail:function(e){console.error(e)}});else if("show"==n.fun_name){e.rankScroll.getComponent(cc.ScrollView).content.removeAllChildren()}else n.fun_name})},t.prototype.loadHttpIcon=function(e,t,n){t&&""!=t||(t="http://thirdwx.qlogo.cn/mmopen/vi_32/opmkDJhG2jpF8X8AfFQfTauRlpBc7VeFicJevZ9IiajEl5g4ia75opNSZOb0FvDV87BvpUN1rsyctibGnicP7uibsMtw/132"),cc.loader.load({url:t,type:"png"},function(t,o){var a=new cc.SpriteFrame(o);e.getComponent(cc.Sprite).spriteFrame=a,n&&n(),console.info("Should load a texture from RESTful API by specify the type: "+(o instanceof cc.Texture2D))})},__decorate([c(cc.Node)],t.prototype,"rankScroll",void 0),__decorate([c(cc.Node)],t.prototype,"rankItem",void 0),__decorate([c(cc.Node)],t.prototype,"selfItem",void 0),t=__decorate([i],t)}(cc.Component);n.default=l,cc._RF.pop()},{}]},{},["SubScene"]);